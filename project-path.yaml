# =============================================================================
# PROJECT PATH - Le chemin complet du projet
# =============================================================================
# D√©finit l'ordre des phases, workflows et leurs d√©pendances.
# L'orchestrateur utilise ce fichier pour guider le projet.
# =============================================================================

# -----------------------------------------------------------------------------
# PHASES DU PROJET
# -----------------------------------------------------------------------------
phases:
  # ---------------------------------------------------------------------------
  # PHASE 0: Analysis (Brownfield uniquement)
  # ---------------------------------------------------------------------------
  - phase: 0
    name: "Analysis"
    description: "Analyse du code existant avant planification"
    agent: "architect"
    condition: "project_type == brownfield"
    workflows:
      - id: "analyze-codebase"
        skill: "/analyze-codebase"
        required: true
        description: "Analyser le code existant pour comprendre l'architecture"
        output: "project-context.md updated with Technical Context"

  # ---------------------------------------------------------------------------
  # PHASE 1: Discovery
  # ---------------------------------------------------------------------------
  - phase: 1
    name: "Discovery"
    description: "Comprendre et clarifier les besoins du client"
    agent: "discovery"
    workflows:
      - id: "frame"
        skill: "/frame"
        required: true
        description: "Cadrage rapide du projet pour estimation"
        output: "output/discovery/frame.md"

      - id: "clarify"
        skill: "/clarify"
        required: true
        depends_on: ["frame"]
        description: "Clarification des besoins d√©taill√©s"
        output: "project-context.md updated"

      - id: "upsell"
        skill: "/upsell"
        required: false
        depends_on: ["clarify"]
        description: "Identification des opportunit√©s d'upselling"
        output: "project-context.md > Upsell Opportunities"

  # ---------------------------------------------------------------------------
  # PHASE 2: Quotation
  # ---------------------------------------------------------------------------
  - phase: 2
    name: "Quotation"
    description: "Estimation et cr√©ation du devis"
    agent: "architect"
    workflows:
      - id: "estimate"
        skill: "/estimate"
        required: true
        depends_on: ["frame"]
        description: "Estimation d√©taill√©e de l'effort"
        output: "output/quotation/estimate.md"

      - id: "quote"
        skill: "/quote"
        required: true
        depends_on: ["estimate"]
        description: "G√©n√©ration du devis formel"
        checkpoint: "quotation_approval"
        checkpoint_message: "Le devis n√©cessite l'approbation du client avant de continuer."
        output: "output/quotation/devis.md"

  # ---------------------------------------------------------------------------
  # PHASE 3: Specs
  # ---------------------------------------------------------------------------
  - phase: 3
    name: "Specs"
    description: "Sp√©cification technique de la solution"
    agent: "architect"
    workflows:
      - id: "spec"
        skill: "/spec"
        required: true
        depends_on: ["quote"]
        description: "Cr√©ation de la sp√©cification technique"
        checkpoint: "architecture_sign_off"
        checkpoint_message: "L'architecture technique doit √™tre valid√©e avant le d√©veloppement."
        output: "output/specs/spec-technique.md"

  # ---------------------------------------------------------------------------
  # PHASE 4: Planning
  # ---------------------------------------------------------------------------
  - phase: 4
    name: "Planning"
    description: "Cr√©ation des stories et planification des sprints"
    agent: "planner"
    workflows:
      - id: "create-story"
        skill: "/create-story"
        required: true
        repeatable: true
        depends_on: ["spec"]
        description: "Cr√©er des stories d√©taill√©es pour le d√©veloppement"
        output: "stories/STORY-XXX.md"

      - id: "plan-sprint"
        skill: "/plan-sprint"
        required: true
        depends_on: ["create-story"]
        description: "Organiser les stories en sprint"
        output: "sprint-status.yaml updated"

  # ---------------------------------------------------------------------------
  # PHASE 5: Development
  # ---------------------------------------------------------------------------
  - phase: 5
    name: "Development"
    description: "Impl√©mentation et tests"
    agent: "developer"
    workflows:
      - id: "implement"
        skill: "/implement"
        required: true
        repeatable: true
        depends_on: ["plan-sprint"]
        description: "Impl√©menter les stories"
        output: "Code + story files updated"

      - id: "test"
        skill: "/test"
        required: true
        repeatable: true
        description: "G√©n√©rer et ex√©cuter les tests"
        output: "Test files + results"

  # ---------------------------------------------------------------------------
  # PHASE 6: Delivery
  # ---------------------------------------------------------------------------
  - phase: 6
    name: "Delivery"
    description: "Documentation et livraison au client"
    agent: "delivery"
    workflows:
      - id: "docs"
        skill: "/docs"
        required: true
        depends_on: ["implement"]
        description: "Cr√©er la documentation utilisateur"
        output: "output/delivery/documentation/"

      - id: "handoff"
        skill: "/handoff"
        required: true
        depends_on: ["docs"]
        description: "Pr√©parer le package de livraison complet"
        checkpoint: "final_delivery"
        checkpoint_message: "La livraison finale n√©cessite une validation avant envoi au client."
        output: "output/delivery/handoff-package/"

# -----------------------------------------------------------------------------
# MAPPING PHASE -> LIBELL√â POUR AFFICHAGE
# -----------------------------------------------------------------------------
phase_labels:
  not_started: "Non d√©marr√©"
  discovery: "Discovery"
  quotation: "Devis"
  specs: "Sp√©cifications"
  planning: "Planification"
  development: "D√©veloppement"
  delivery: "Livraison"
  completed: "Termin√©"

# -----------------------------------------------------------------------------
# R√àGLES DE TRANSITION
# -----------------------------------------------------------------------------
transition_rules:
  # On ne peut pas sauter de phase (sauf si explicitement autoris√©)
  allow_skip: false

  # Workflows optionnels peuvent √™tre saut√©s
  allow_skip_optional: true

  # Les checkpoints bloquent TOUJOURS la progression
  checkpoints_are_blocking: true

  # Un workflow repeatable peut √™tre ex√©cut√© plusieurs fois
  # mais doit √™tre ex√©cut√© au moins une fois si required: true

  # üö® QUALITY GATES - OBLIGATOIRES AVANT TRANSITION
  quality_gates_are_blocking: true

# -----------------------------------------------------------------------------
# QUALITY GATES PAR TRANSITION DE PHASE
# -----------------------------------------------------------------------------
# Chaque quality gate DOIT passer avant de pouvoir transitionner.
# Un gate "blocked" emp√™che TOUTE progression vers la phase suivante.
# -----------------------------------------------------------------------------
phase_quality_gates:
  # Avant de quitter Discovery ‚Üí Quotation
  discovery_to_quotation:
    gate_file: "discovery-gate.md"
    required_items:
      - "Tous les besoins ont un 'pourquoi' document√©"
      - "Au moins 3 sc√©narios concrets par feature"
      - "Hidden needs identifi√©s"
      - "Aucun terme ambigu non r√©solu"
      - "Jobs-to-be-Done clairement articul√©"
      - "Scope IN/OUT d√©fini"
      - "M√©triques de succ√®s d√©finies"
      - "project-context.md √† jour"
    block_message: |
      üö¶ QUALITY GATE BLOQU√â: Discovery ‚Üí Quotation
      Les crit√®res suivants ne sont pas satisfaits:
      {blocking_items}
      Veuillez les compl√©ter avant de passer au devis.

  # Avant de quitter Specs ‚Üí Planning
  specs_to_planning:
    gate_file: "specs-gate.md"
    required_items:
      - "Toutes les d√©cisions techniques ont un ADR"
      - "Trade-offs explicites pour chaque d√©cision"
      - "Spec couvre 100% des requirements"
      - "Tous les cas d'erreur sp√©cifi√©s"
      - "Edge cases couverts"
      - "Review adversarial effectu√©e (3+ issues)"
      - "Issues CRITICAL/MAJOR r√©solus"
      - "architecture_sign_off obtenu"
    block_message: |
      üö¶ QUALITY GATE BLOQU√â: Specs ‚Üí Planning
      La sp√©cification technique n'est pas pr√™te:
      {blocking_items}
      Veuillez r√©soudre ces points avant de cr√©er des stories.

  # Avant de quitter Planning ‚Üí Development
  planning_to_development:
    gate_file: "planning-gate.md"
    required_items:
      - "Chaque story a des AC testables (Given/When/Then)"
      - "Chaque story a des subtasks avec fichiers"
      - "Chaque story a des tests attendus"
      - "Estimations < 4h par subtask"
      - "D√©pendances identifi√©es"
      - "Sprint capacity respect√©e (buffer 20%)"
    block_message: |
      üö¶ QUALITY GATE BLOQU√â: Planning ‚Üí Development
      Les stories ne sont pas pr√™tes pour le d√©veloppement:
      {blocking_items}
      Compl√©tez les stories avant de commencer √† coder.

  # Par story avant de marquer "done" (STRICT)
  story_done:
    gate_file: "development-gate.md"
    required_items:
      - "üö® ZERO placeholders dans le code"
      - "Code compile sans erreur"
      - "Tous les AC satisfaits"
      - "Tests EXISTENT pour chaque AC"
      - "Tous les tests PASSENT"
      - "Code review effectu√©e (3+ issues)"
      - "BLOCKERS r√©solus"
      - "MAJOR issues r√©solus"
    block_message: |
      üö¶ STORY NON TERMIN√âE
      Cette story ne peut pas √™tre marqu√©e "done":
      {blocking_items}
      ‚ö†Ô∏è AUCUN PLACEHOLDER N'EST ACCEPTABLE.

  # Avant livraison finale
  development_to_delivery:
    gate_file: "delivery-gate.md"
    required_items:
      - "Toutes les stories done"
      - "Tous les tests passent"
      - "Documentation compl√®te"
      - "Runbook test√© (backup/restore)"
      - "Package de livraison complet"
      - "Validation finale effectu√©e"
    block_message: |
      üö¶ QUALITY GATE BLOQU√â: Livraison
      Le projet n'est pas pr√™t pour la livraison:
      {blocking_items}
      Compl√©tez ces √©l√©ments avant de livrer au client.
